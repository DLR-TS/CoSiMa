FROM ubuntu:18.04 AS cosima_builder
MAINTAINER bjoern.bahn@dlr.de

ENV DEBIAN_FRONTEND=noninteractive MAKEFLAGS="-j$(nproc)"
RUN apt-get update && apt-get install -y build-essential python3-pip git && rm -rf /var/lib/apt/lists/*

RUN python3 -m pip install --upgrade pip
RUN pip3 install cmake==3.28.1 conan==1.59.0

RUN mkdir cosima && mkdir cosima/build
WORKDIR /cosima/build
COPY . /cosima/

RUN cmake .. -DCMAKE_CXX_STANDARD=14 -DBUILD_SHARED_LIBS=false -DCMAKE_BUILD_TYPE=Release
RUN cmake --build . --target CoSimulationManager

FROM ubuntu:18.04
COPY --from=cosima_builder /cosima/build/bin/CoSimulationManager .
CMD ./CoSimulationManager -v config.yml
